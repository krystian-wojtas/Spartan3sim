%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                    %
%  pgflibrarytikzcircuits.code.tex                                   %
%                                                                    %
%  Version 0.0.1                                                     %
%                                                                    %
%  Authors: Juergen Werber and Christoph Bartoschek                  %
%  Email:   bartoschek -at- or.uni-bonn.de                           %
%                                                                    %
% This file may be distributed and/or modified                       %
%   1. under the LaTeX Project Public License Version 1.3 or later   %
% and/or                                                             %
%   2. under the GNU Public License Version 2 or later.              %
%                                                                    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%   USAGE EXAMPLE   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \documentclass{article}
% \usepackage{tikz}
% \usetikzlibrary{circuits}
%
% \begin{document}
% \begin{tikzpicture}[scale=0.5,cktbaselength=0.5pt]
% \draw (6,0) node[nand2ni,anchor=tip,draw] (n4) {}
%       (n4.z) -- +(0mm,-5mm)
%       (n4.b) |- ++(10mm,2mm) -- ++(0mm,2mm)
%       node[and2in,anchor=z,draw,fill=gray] (n3) {}
%       (n4.a) |- ++(-10mm,2mm) -- ++(0mm,2mm)
%       node[or3nni,anchor=tip,draw] (n2) {}
%       (n3.b) -- +(0mm,5mm) node[above] {$i_5$}
%       (n3.a) |- ++(-5mm,2mm)
%       coordinate (p) -- +(0mm,5mm) node[above] {$i_4$}
%       (n2.c) |- (p)
%       (n2.b) |- ++(6mm,12mm) -- +(0mm,5mm) node[above] {$i_3$}
%       (n2.a) -- +(0mm,8mm)
%       node[and2,anchor=tip,draw] (n1) {}
%       (n1.b) -- +(0mm,5mm) node[above] {$i_2$}
%       (n1.a) -- +(0mm,5mm) node[above] {$i_1$};
% \end{tikzpicture}
% \end{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\pgfsetcktbaselength#1{\def\cktbaselength{#1}}
\pgfsetcktbaselength{2pt}
\tikzoption{cktbaselength}{\pgfsetcktbaselength{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\cktsetbasexandyvec{%
\pgfsetxvec{\pgfpoint{\baselength}{0pt}}
\pgfsetyvec{\pgfpoint{0pt}{\baselength}}
}

\def\cktsetcktbasexandyvec{%
\pgfsetxvec{\pgfpoint{\cktbaselength}{0pt}}
\pgfsetyvec{\pgfpoint{0pt}{\cktbaselength}}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\cktdrawtrianglenonclosed{%
\pgfpathmoveto{\pgfpointorigin}
\pgfpathlineto{\pgfpointxy{10}{20}}
\pgfpathlineto{\pgfpointxy{-10}{20}}
}

\def\cktdrawfitwotrunk{%
\pgfpathmoveto{\pgfpointxy{20}{28}}
\pgfpathcurveto{\pgfpointxy{20}{4}}{\pgfpointxy{8}{0}}{\pgfpointorigin}
\pgfpathcurveto{\pgfpointxy{-8}{0}}{\pgfpointxy{-20}{4}}{\pgfpointxy{-20}{28}}
}

\def\cktdrawandtwoshape{%
\cktdrawfitwotrunk
\pgfpathclose
}

\def\cktdrawortwoshape{%
\cktdrawfitwotrunk
\pgfpathcurveto{\pgfpointxy{-6}{16}}{\pgfpointxy{6}{16}}{\pgfpointxy{20}{28}}
\pgfpathclose
}

\def\cktdrawfithreetrunk{%
\pgfpathmoveto{\pgfpointxy{30}{30}}
\pgfpathcurveto{\pgfpointxy{30}{6}}{\pgfpointxy{12}{0}}{\pgfpointorigin}
\pgfpathcurveto{\pgfpointxy{-12}{0}}{\pgfpointxy{-30}{6}}{\pgfpointxy{-30}{30}}
}

\def\cktdrawandthreeshape{%
\cktdrawfithreetrunk
\pgfpathclose
}

\def\cktdraworthreeshape{%
\cktdrawfithreetrunk
\pgfpathcurveto{\pgfpointxy{-10}{16}}{\pgfpointxy{10}{16}}{\pgfpointxy{30}{30}}
\pgfpathclose
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\cktlocateortwoaanchor{%
\pgfpointcurveattime{0.2452}{\pgfpointxy{-20}{28}}{\pgfpointxy{-6}{16}}{\pgfpointxy{6}{16}}{\pgfpointxy{20}{28}}%
}

\def\cktlocateorthreeaanchor{%
\pgfpointcurveattime{0.1667}{\pgfpointxy{-30}{30}}{\pgfpointxy{-10}{16}}{\pgfpointxy{10}{16}}{\pgfpointxy{30}{30}}%
}

\def\cktlocateorthreebanchor{%
\pgfpointcurveattime{0.5}{\pgfpointxy{-30}{30}}{\pgfpointxy{-10}{16}}{\pgfpointxy{10}{16}}{\pgfpointxy{30}{30}}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\cktdrawzinversion{%
\@tempdima=\baselength
\pgfpathcircle{\pgfpointxy{0}{-3}}{3\@tempdima}
}

\def\cktdrawandtwoainversion{%
\@tempdima=\baselength
\pgfpathcircle{\pgfpointxy{-10}{31}}{3\@tempdima}
}

\def\cktdrawandtwobinversion{%
\@tempdima=\baselength
\pgfpathcircle{\pgfpointxy{10}{31}}{3\@tempdima}
}

\def\cktdrawortwoainversion{%
\@tempdima=\baselength
\pgfpathcircle{\pgfpoint{-10\@tempdima}{\ycirccenter}}{3\@tempdima}
}

\def\cktdrawortwobinversion{%
\@tempdima=\baselength
\pgfpathcircle{\pgfpoint{10\@tempdima}{\ycirccenter}}{3\@tempdima}
}

\def\cktdrawandthreeainversion{%
\@tempdima=\baselength
\pgfpathcircle{\pgfpointxy{-20}{33}}{3\@tempdima}
}

\def\cktdrawandthreebinversion{%
\@tempdima=\baselength
\pgfpathcircle{\pgfpointxy{0}{33}}{3\@tempdima}
}

\def\cktdrawandthreecinversion{%
\@tempdima=\baselength
\pgfpathcircle{\pgfpointxy{20}{33}}{3\@tempdima}
}

\def\cktdraworthreeainversion{%
\@tempdima=\baselength
\pgfpathcircle{\pgfpoint{-20\@tempdima}{\ycirccenter}}{3\@tempdima}
}

\def\cktdraworthreebinversion{%
\pgfpointcurveattime{0.5}{\pgfpointxy{-30}{30}}{\pgfpointxy{-10}{16}}{\pgfpointxy{10}{16}}{\pgfpointxy{30}{30}}%
\@tempdima=\baselength
\advance\pgf@y by 3\@tempdima
\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{3\@tempdima}
}

\def\cktdraworthreecinversion{%
\@tempdima=\baselength
\pgfpathcircle{\pgfpoint{20\@tempdima}{\ycirccenter}}{3\@tempdima}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pgfdeclareshape{buffer}{
  \saveddimen{\baselength}{
    \pgf@x=\cktbaselength
  }
  % TODO: chose barycenter for center instead?
  \anchor{center}{     \cktsetbasexandyvec \pgfpointxy{0}{10} }
  \anchor{north west}{ \cktsetbasexandyvec \pgfpointxy{-10}{20} }
  \anchor{north}{      \cktsetbasexandyvec \pgfpointxy{0}{20} }
  \anchor{north east}{ \cktsetbasexandyvec \pgfpointxy{10}{20} }
  \anchor{west}{       \cktsetbasexandyvec \pgfpointxy{-10}{10} }
  \anchor{east}{       \cktsetbasexandyvec \pgfpointxy{10}{10} }
  \anchor{south west}{ \cktsetbasexandyvec \pgfpointxy{-10}{0} }
  \anchor{south}{      \pgfpointorigin }
  \anchor{south east}{ \cktsetbasexandyvec \pgfpointxy{10}{0} }
  \anchor{a}{          \cktsetbasexandyvec \pgfpointxy{0}{20} }
  \anchor{z}{          \pgfpointorigin }
  \anchor{tip}{        \pgfpointorigin }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawtrianglenonclosed
    \pgfpathclose
  }
}

\pgfdeclareshape{inverter}{
  \inheritsavedanchors[from=buffer]
  \inheritanchor[from=buffer]{center}
  \inheritanchor[from=buffer]{north west}
  \inheritanchor[from=buffer]{north}
  \inheritanchor[from=buffer]{north east}
  \inheritanchor[from=buffer]{tip}
  \inheritanchor[from=buffer]{a}
  \anchor{west}{       \cktsetbasexandyvec \pgfpointxy{-10}{7} }
  \anchor{east}{       \cktsetbasexandyvec \pgfpointxy{10}{7} }
  \anchor{south west}{ \cktsetbasexandyvec \pgfpointxy{-10}{-6} }
  \anchor{south}{      \cktsetbasexandyvec \pgfpointxy{0}{-6} }
  \anchor{south east}{ \cktsetbasexandyvec \pgfpointxy{10}{-6} }
  \anchor{z}{          \cktsetbasexandyvec \pgfpointxy{0}{-6} }
  \backgroundpath{
    \cktsetbasexandyvec
    % The inverter looks nicer if the path is not closed.
    \cktdrawtrianglenonclosed
    \pgfpathlineto{\pgfpointorigin}
    \cktdrawzinversion
  }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pgfdeclareshape{and2}{
  \saveddimen{\baselength}{
    \pgf@x=\cktbaselength
  }
  % TODO: chose barycenter for center instead?
  \anchor{center}{     \cktsetbasexandyvec \pgfpointxy{0}{14} }
  \anchor{north west}{ \cktsetbasexandyvec \pgfpointxy{-20}{28} }
  \anchor{north}{      \cktsetbasexandyvec \pgfpointxy{0}{28} }
  \anchor{north east}{ \cktsetbasexandyvec \pgfpointxy{20}{28} }
  \anchor{west}{       \cktsetbasexandyvec \pgfpointxy{-20}{14} }
  \anchor{east}{       \cktsetbasexandyvec \pgfpointxy{20}{14} }
  \anchor{south west}{ \cktsetbasexandyvec \pgfpointxy{-20}{0} }
  \anchor{south}{      \pgfpointorigin }
  \anchor{south east}{ \cktsetbasexandyvec \pgfpointxy{20}{0} }
  \anchor{a}{          \cktsetbasexandyvec \pgfpointxy{-10}{28} }
  \anchor{b}{          \cktsetbasexandyvec \pgfpointxy{10}{28} }
  \anchor{z}{          \pgfpointorigin }
  \anchor{tip}{        \pgfpointorigin }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawandtwoshape
  }
}

\pgfdeclareshape{nand2ii}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=and2]{west}
  \inheritanchor[from=and2]{east}
  \inheritanchor[from=and2]{tip}
  \anchor{north west}{ \cktsetbasexandyvec \pgfpointxy{-20}{34} }
  \anchor{north}{      \cktsetbasexandyvec \pgfpointxy{0}{34} }
  \anchor{north east}{ \cktsetbasexandyvec \pgfpointxy{20}{34} }
  \anchor{south west}{ \cktsetbasexandyvec \pgfpointxy{-20}{-6} }
  \anchor{south}{      \cktsetbasexandyvec \pgfpointxy{0}{-6} }
  \anchor{south east}{ \cktsetbasexandyvec \pgfpointxy{20}{-6} }
  \anchor{a}{          \cktsetbasexandyvec \pgfpointxy{-10}{34} }
  \anchor{b}{          \cktsetbasexandyvec \pgfpointxy{10}{34} }
  \anchor{z}{          \cktsetbasexandyvec \pgfpointxy{0}{-6} }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawandtwoshape
    \cktdrawandtwoainversion
    \cktdrawandtwobinversion
    \cktdrawzinversion
  }
}

\pgfdeclareshape{and2in}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nand2ii]{north west}
  \inheritanchor[from=nand2ii]{north}
  \inheritanchor[from=nand2ii]{north east}
  \inheritanchor[from=and2]{south east}
  \inheritanchor[from=and2]{south}
  \inheritanchor[from=and2]{south west}
  \inheritanchor[from=nand2ii]{a}
  \inheritanchor[from=and2]{b}
  \inheritanchor[from=and2]{z}
  \inheritanchor[from=and2]{tip}
  \anchor{west}{       \cktsetbasexandyvec \pgfpointxy{-20}{17} }
  \anchor{east}{       \cktsetbasexandyvec \pgfpointxy{20}{17} }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawandtwoshape
    \cktdrawandtwoainversion
  }
}

\pgfdeclareshape{and2ni}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nand2ii]{north west}
  \inheritanchor[from=nand2ii]{north}
  \inheritanchor[from=nand2ii]{north east}
  \inheritanchor[from=and2in]{west}
  \inheritanchor[from=and2in]{east}
  \inheritanchor[from=and2]{south east}
  \inheritanchor[from=and2]{south}
  \inheritanchor[from=and2]{south west}
  \inheritanchor[from=and2]{a}
  \inheritanchor[from=nand2ii]{b}
  \inheritanchor[from=and2]{z}
  \inheritanchor[from=and2]{tip}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawandtwoshape
    \cktdrawandtwobinversion
  }
}

\pgfdeclareshape{and2ii}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nand2ii]{north west}
  \inheritanchor[from=nand2ii]{north}
  \inheritanchor[from=nand2ii]{north east}
  \inheritanchor[from=and2in]{west}
  \inheritanchor[from=and2in]{east}
  \inheritanchor[from=and2]{south east}
  \inheritanchor[from=and2]{south}
  \inheritanchor[from=and2]{south west}
  \inheritanchor[from=nand2ii]{a}
  \inheritanchor[from=nand2ii]{b}
  \inheritanchor[from=and2]{z}
  \inheritanchor[from=and2]{tip}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawandtwoshape
    \cktdrawandtwoainversion
    \cktdrawandtwobinversion
  }
}

\pgfdeclareshape{nand2}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=and2]{north west}
  \inheritanchor[from=and2]{north}
  \inheritanchor[from=and2]{north east}
  \inheritanchor[from=nand2ii]{south east}
  \inheritanchor[from=nand2ii]{south}
  \inheritanchor[from=nand2ii]{south west}
  \inheritanchor[from=and2]{a}
  \inheritanchor[from=and2]{b}
  \inheritanchor[from=nand2ii]{z}
  \inheritanchor[from=and2]{tip}
  \anchor{west}{       \cktsetbasexandyvec \pgfpointxy{-20}{11} }
  \anchor{east}{       \cktsetbasexandyvec \pgfpointxy{20}{11} }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawandtwoshape
    \cktdrawzinversion
  }
}

\pgfdeclareshape{nand2in}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nand2ii]{north west}
  \inheritanchor[from=nand2ii]{north}
  \inheritanchor[from=nand2ii]{north east}
  \inheritanchor[from=nand2ii]{west}
  \inheritanchor[from=nand2ii]{east}
  \inheritanchor[from=nand2ii]{south east}
  \inheritanchor[from=nand2ii]{south}
  \inheritanchor[from=nand2ii]{south west}
  \inheritanchor[from=nand2ii]{a}
  \inheritanchor[from=and2]{b}
  \inheritanchor[from=nand2ii]{z}
  \inheritanchor[from=and2]{tip}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawandtwoshape
    \cktdrawandtwoainversion
    \cktdrawzinversion
  }
}

\pgfdeclareshape{nand2ni}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nand2ii]{north west}
  \inheritanchor[from=nand2ii]{north}
  \inheritanchor[from=nand2ii]{north east}
  \inheritanchor[from=nand2ii]{west}
  \inheritanchor[from=nand2ii]{east}
  \inheritanchor[from=nand2ii]{south east}
  \inheritanchor[from=nand2ii]{south}
  \inheritanchor[from=nand2ii]{south west}
  \inheritanchor[from=and2]{a}
  \inheritanchor[from=nand2ii]{b}
  \inheritanchor[from=nand2ii]{z}
  \inheritanchor[from=and2]{tip}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawandtwoshape
    \cktdrawandtwobinversion
    \cktdrawzinversion
  }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pgfdeclareshape{or2}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=and2]{north west}
  \inheritanchor[from=and2]{north}
  \inheritanchor[from=and2]{north east}
  \inheritanchor[from=and2]{west}
  \inheritanchor[from=and2]{east}
  \inheritanchor[from=and2]{south east}
  \inheritanchor[from=and2]{south}
  \inheritanchor[from=and2]{south west}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=and2]{z}
  \anchor{a}{ \cktsetbasexandyvec \cktlocateortwoaanchor }
  \anchor{b}{ \cktsetbasexandyvec \cktlocateortwoaanchor \pgf@x=-\pgf@x }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawortwoshape
  }
}

\pgfdeclareshape{nor2ii}{
  \inheritsavedanchors[from=and2]
  \saveddimen\ycirccenter{
    \cktsetcktbasexandyvec
    \pgfpointxy{24.685}{0}
  }
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nand2]{west} % TODO: This is not exact
  \inheritanchor[from=nand2]{east} % TODO: This is not exact
  \inheritanchor[from=nand2ii]{south east}
  \inheritanchor[from=nand2ii]{south}
  \inheritanchor[from=nand2ii]{south west}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=nand2ii]{z}
  \anchor{north west}{ \cktsetbasexandyvec \pgfpointxy{-20}{3} \advance\pgf@y by \ycirccenter }
  \anchor{north}{      \cktsetbasexandyvec \pgfpointxy{0}{3} \advance\pgf@y by \ycirccenter }
  \anchor{north east}{ \cktsetbasexandyvec \pgfpointxy{20}{3} \advance\pgf@y by \ycirccenter }
  \anchor{a}{          \cktsetbasexandyvec \pgfpointxy{-10}{3} \advance\pgf@y by \ycirccenter }
  \anchor{b}{          \cktsetbasexandyvec \pgfpointxy{10}{3} \advance\pgf@y by \ycirccenter }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawortwoshape
    \cktdrawortwoainversion
    \cktdrawortwobinversion
    \cktdrawzinversion
  }
}

\pgfdeclareshape{or2in}{
  \inheritsavedanchors[from=nor2ii]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nor2ii]{north west}
  \inheritanchor[from=nor2ii]{north}
  \inheritanchor[from=nor2ii]{north east}
  \inheritanchor[from=nand2ii]{east} % TODO: This is not exact
  \inheritanchor[from=nand2ii]{west} % TODO: This is not exact
  \inheritanchor[from=and2]{south east}
  \inheritanchor[from=and2]{south}
  \inheritanchor[from=and2]{south west}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=nor2ii]{a}
  \inheritanchor[from=or2]{b}
  \inheritanchor[from=and2]{z}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawortwoshape
    \cktdrawortwoainversion
  }
}

\pgfdeclareshape{or2ni}{
  \inheritsavedanchors[from=nor2ii]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nor2ii]{north west}
  \inheritanchor[from=nor2ii]{north}
  \inheritanchor[from=nor2ii]{north east}
  \inheritanchor[from=or2in]{west}
  \inheritanchor[from=or2in]{east}
  \inheritanchor[from=and2]{south east}
  \inheritanchor[from=and2]{south}
  \inheritanchor[from=and2]{south west}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=or2]{a}
  \inheritanchor[from=nor2ii]{b}
  \inheritanchor[from=and2]{z}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawortwoshape
    \cktdrawortwobinversion
  }
}

\pgfdeclareshape{or2ii}{
  \inheritsavedanchors[from=nor2ii]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nor2ii]{north west}
  \inheritanchor[from=nor2ii]{north}
  \inheritanchor[from=nor2ii]{north east}
  \inheritanchor[from=or2in]{west}
  \inheritanchor[from=or2in]{east}
  \inheritanchor[from=and2]{south east}
  \inheritanchor[from=and2]{south}
  \inheritanchor[from=and2]{south west}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=nor2ii]{a}
  \inheritanchor[from=nor2ii]{b}
  \inheritanchor[from=and2]{z}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawortwoshape
    \cktdrawortwoainversion
    \cktdrawortwobinversion
  }
}

\pgfdeclareshape{nor2}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=and2]{north west}
  \inheritanchor[from=and2]{north}
  \inheritanchor[from=and2]{north east}
  \inheritanchor[from=nand2]{east}
  \inheritanchor[from=nand2]{west}
  \inheritanchor[from=nand2ii]{south east}
  \inheritanchor[from=nand2ii]{south}
  \inheritanchor[from=nand2ii]{south west}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=or2]{a}
  \inheritanchor[from=or2]{b}
  \inheritanchor[from=nor2ii]{z}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawortwoshape
    \cktdrawzinversion
  }
}

\pgfdeclareshape{nor2in}{
  \inheritsavedanchors[from=nor2ii]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nor2ii]{north west}
  \inheritanchor[from=nor2ii]{north}
  \inheritanchor[from=nor2ii]{north east}
  \inheritanchor[from=nor2ii]{west}
  \inheritanchor[from=nor2ii]{east}
  \inheritanchor[from=nand2ii]{south east}
  \inheritanchor[from=nand2ii]{south}
  \inheritanchor[from=nand2ii]{south west}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=nor2ii]{a}
  \inheritanchor[from=or2]{b}
  \inheritanchor[from=nor2ii]{z}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawortwoshape
    \cktdrawortwoainversion
    \cktdrawzinversion
  }
}

\pgfdeclareshape{nor2ni}{
  \inheritsavedanchors[from=nor2ii]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nor2ii]{north west}
  \inheritanchor[from=nor2ii]{north}
  \inheritanchor[from=nor2ii]{north east}
  \inheritanchor[from=nor2ii]{west}
  \inheritanchor[from=nor2ii]{east}
  \inheritanchor[from=nand2ii]{south east}
  \inheritanchor[from=nand2ii]{south}
  \inheritanchor[from=nand2ii]{south west}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=or2]{a}
  \inheritanchor[from=nor2ii]{b}
  \inheritanchor[from=nor2ii]{z}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawortwoshape
    \cktdrawortwobinversion
    \cktdrawzinversion
  }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pgfdeclareshape{and3}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=and2]{z}
  \anchor{north west}{ \cktsetbasexandyvec \pgfpointxy{-30}{30} }
  \anchor{north}{      \cktsetbasexandyvec \pgfpointxy{0}{30} }
  \anchor{north east}{ \cktsetbasexandyvec \pgfpointxy{30}{30} }
  \anchor{west}{       \cktsetbasexandyvec \pgfpointxy{-30}{15} }
  \anchor{east}{       \cktsetbasexandyvec \pgfpointxy{30}{15} }
  \anchor{south west}{ \cktsetbasexandyvec \pgfpointxy{-30}{0} }
  \anchor{south}{      \pgfpointorigin }
  \anchor{south east}{ \cktsetbasexandyvec \pgfpointxy{30}{0} }
  \anchor{a}{          \cktsetbasexandyvec \pgfpointxy{-20}{30} }
  \anchor{b}{          \cktsetbasexandyvec \pgfpointxy{0}{30} }
  \anchor{c}{          \cktsetbasexandyvec \pgfpointxy{20}{30} }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawandthreeshape
  }
}

\pgfdeclareshape{nand3iii}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=nand2ii]{z}
  \inheritanchor[from=and3]{west}
  \inheritanchor[from=and3]{east}
  \anchor{north west}{ \cktsetbasexandyvec \pgfpointxy{-30}{36} }
  \anchor{north}{      \cktsetbasexandyvec \pgfpointxy{0}{36} }
  \anchor{north east}{ \cktsetbasexandyvec \pgfpointxy{30}{36} }
  \anchor{south west}{ \cktsetbasexandyvec \pgfpointxy{-30}{-6} }
  \anchor{south}{      \cktsetbasexandyvec \pgfpointxy{0}{-6} }
  \anchor{south east}{ \cktsetbasexandyvec \pgfpointxy{30}{-6} }
  \anchor{a}{          \cktsetbasexandyvec \pgfpointxy{-20}{36} }
  \anchor{b}{          \cktsetbasexandyvec \pgfpointxy{0}{36} }
  \anchor{c}{          \cktsetbasexandyvec \pgfpointxy{20}{36} }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawandthreeshape
    \cktdrawandthreeainversion
    \cktdrawandthreebinversion
    \cktdrawandthreecinversion
    \cktdrawzinversion
  }
}

\pgfdeclareshape{and3nni}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=and2]{z}
  \inheritanchor[from=nand3iii]{north west}
  \inheritanchor[from=nand3iii]{north}
  \inheritanchor[from=nand3iii]{north east}
  \inheritanchor[from=and3]{south west}
  \inheritanchor[from=and3]{south}
  \inheritanchor[from=and3]{south east}
  \inheritanchor[from=and3]{a}
  \inheritanchor[from=and3]{b}
  \inheritanchor[from=nand3iii]{c}
  \anchor{west}{       \cktsetbasexandyvec \pgfpointxy{-30}{18} }
  \anchor{east}{       \cktsetbasexandyvec \pgfpointxy{30}{18} }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdrawandthreeshape
    \cktdrawandthreecinversion
  }
}

\pgfdeclareshape{or3}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=and2]{z}
  \anchor{north west}{ \cktsetbasexandyvec \pgfpointxy{-30}{30} }
  \anchor{north}{      \cktsetbasexandyvec \pgfpointxy{0}{30} }
  \anchor{north east}{ \cktsetbasexandyvec \pgfpointxy{30}{30} }
  \anchor{west}{       \cktsetbasexandyvec \pgfpointxy{-30}{15} }
  \anchor{east}{       \cktsetbasexandyvec \pgfpointxy{30}{15} }
  \anchor{south west}{ \cktsetbasexandyvec \pgfpointxy{-30}{0} }
  \anchor{south}{      \pgfpointorigin }
  \anchor{south east}{ \cktsetbasexandyvec \pgfpointxy{30}{0} }
  \anchor{a}{ \cktsetbasexandyvec \cktlocateorthreeaanchor }
  \anchor{b}{ \cktsetbasexandyvec \cktlocateorthreebanchor }
  \anchor{c}{ \cktsetbasexandyvec \cktlocateorthreeaanchor \pgf@x=-\pgf@x }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdraworthreeshape
  }
}

\pgfdeclareshape{nor3iii}{
  \inheritsavedanchors[from=and2]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=nand2ii]{z}
  \saveddimen\ycirccenter{
    \cktsetcktbasexandyvec
    \pgfpointxy{27.505}{0}
  }
  \anchor{north west}{ \cktsetbasexandyvec \pgfpointxy{-30}{30.505} }
  \anchor{north}{      \cktsetbasexandyvec \pgfpointxy{0}{30.505} }
  \anchor{north east}{ \cktsetbasexandyvec \pgfpointxy{30}{30.505} }
  \anchor{west}{       \cktsetbasexandyvec \pgfpointxy{-30}{15.2525} }
  \anchor{east}{       \cktsetbasexandyvec \pgfpointxy{30}{15.2525} }
  \anchor{south west}{ \cktsetbasexandyvec \pgfpointxy{-30}{-6} }
  \anchor{south}{      \cktsetbasexandyvec \pgfpointxy{0}{-6} }
  \anchor{south east}{ \cktsetbasexandyvec \pgfpointxy{30}{-6} }
  \anchor{a}{ \cktsetbasexandyvec \pgfpointxy{-20}{3} \advance\pgf@y by \ycirccenter }
  \anchor{b}{
    \cktsetbasexandyvec
    \pgfpointcurveattime{0.5}%
        {\pgfpointxy{-30}{30}}%
        {\pgfpointxy{-10}{16}}%
        {\pgfpointxy{10}{16}}%
        {\pgfpointxy{30}{30}}%
    \@tempdima=\baselength
    \advance\pgf@y by 6\@tempdima
  }
  \anchor{c}{ \cktsetbasexandyvec \pgfpointxy{20}{3} \advance\pgf@y by \ycirccenter }
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdraworthreeshape
    \cktdraworthreeainversion
    \cktdraworthreebinversion
    \cktdraworthreecinversion
    \cktdrawzinversion
  }
}

\pgfdeclareshape{or3nni}{
  \inheritsavedanchors[from=nor3iii]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=nor3iii]{north west}
  \inheritanchor[from=nor3iii]{north}
  \inheritanchor[from=nor3iii]{north east}
  \inheritanchor[from=or3]{east} % TODO: This is not exact
  \inheritanchor[from=or3]{west} % TODO: This is not exact
  \inheritanchor[from=or3]{south west}
  \inheritanchor[from=or3]{south}
  \inheritanchor[from=or3]{south east}
  \inheritanchor[from=and2]{tip}
  \inheritanchor[from=and2]{z}
  \inheritanchor[from=or3]{a}
  \inheritanchor[from=or3]{b}
  \inheritanchor[from=nor3iii]{c}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdraworthreeshape
    \cktdraworthreecinversion
  }
}

\pgfdeclareshape{nor3}{
  \inheritsavedanchors[from=nor3iii]
  \inheritanchor[from=and2]{center}
  \inheritanchor[from=or3]{north west}
  \inheritanchor[from=or3]{north}
  \inheritanchor[from=or3]{north east}
  \inheritanchor[from=or3]{east} % TODO: This is not exact
  \inheritanchor[from=or3]{west} % TODO: This is not exact
  \inheritanchor[from=nor3iii]{south west}
  \inheritanchor[from=nor3iii]{south}
  \inheritanchor[from=nor3iii]{south east}
  \inheritanchor[from=nand2ii]{tip}
  \inheritanchor[from=nand2ii]{z}
  \inheritanchor[from=or3]{a}
  \inheritanchor[from=or3]{b}
  \inheritanchor[from=or3]{c}
  \backgroundpath{
    \cktsetbasexandyvec
    \cktdraworthreeshape
    \cktdrawzinversion
  }
}

